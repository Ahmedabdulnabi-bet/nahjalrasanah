<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nahj Al-Rasanah | Vendor Login</title>
    <link rel="icon" type="image/png" href="assets/images/logo-store.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/styles.css">
  </head>
  <body data-page="vendor-login">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
          <img src="assets/images/logo-store.png" alt="Nahj Oil &amp; Gas Store" width="32" height="32" class="rounded-circle border border-secondary">
          <span class="fw-semibold">
            Nahj Al-Rasanah<br>
            <small class="text-muted" style="font-size:0.7rem;">Vendor Login</small>
          </span>
        </a>
        <div id="auth-nav-container">
          <a href="index.html" class="btn btn-outline-light btn-sm">
            <i class="bi bi-arrow-left"></i> Back to Store
          </a>
        </div>
      </div>
    </nav>

    <main class="container py-5">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
          <div class="card shadow-lg border-0">
            <div class="card-body p-4">
              <div class="text-center mb-4">
                <i class="bi bi-person-badge display-4 text-primary"></i>
                <h2 class="h4 fw-bold mt-3">Vendor Login</h2>
                <p class="text-muted">Access your vendor dashboard</p>
              </div>
              
              <form id="vendor-login-form">
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                    <input type="email" class="form-control" id="email" required placeholder="vendor@example.com">
                  </div>
                </div>
                
                <div class="mb-4">
                  <label for="password" class="form-label">Password</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-lock"></i></span>
                    <input type="password" class="form-control" id="password" required>
                  </div>
                </div>
                
                <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
                  <i class="bi bi-box-arrow-in-right"></i> Sign In
                </button>
                
                <div class="alert alert-info small">
                  <i class="bi bi-info-circle"></i> Vendors can manage their products and view RFQs.
                </div>
                
                <div id="login-error" class="alert alert-danger d-none mt-3"></div>
              </form>
            </div>
          </div>
          
          <div class="text-center mt-4">
            <a href="admin.html" class="text-decoration-none small">
              <i class="bi bi-shield-check"></i> Admin Login
            </a>
            <span class="mx-2">•</span>
            <a href="index.html" class="text-decoration-none small">
              <i class="bi bi-house"></i> Return to Store
            </a>
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-dark text-light mt-5 pt-4 pb-3">
      <div class="container">
        <div class="row gy-3">
          <div class="col-md-6">
            <h6 class="fw-semibold mb-2">Nahj Al-Rasanah Vendor Portal</h6>
            <p class="small mb-0">
              Oil &amp; Gas Supplies – Vendor Management System
            </p>
          </div>
          <div class="col-md-3">
            <h6 class="fw-semibold mb-2">Need Help?</h6>
            <p class="small mb-0">
              Contact: <a href="mailto:vendors@nahjalrasanah.com" class="link-light text-decoration-none">vendors@nahjalrasanah.com</a>
            </p>
          </div>
          <div class="col-md-3">
            <h6 class="fw-semibold mb-2">Note</h6>
            <p class="small mb-0">
              Vendor access is by invitation only.
            </p>
          </div>
        </div>
        <hr class="border-secondary my-3">
        <p class="small text-center mb-0">&copy; <span id="year"></span> Nahj Al-Rasanah LLC</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- الكود الموحد -->
    <script type="module">
      import { firebaseConfig } from './assets/js/firebase-config.js';
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
      import { 
        getAuth, 
        signInWithEmailAndPassword 
      } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
      
      document.addEventListener('DOMContentLoaded', function() {
        console.log('Vendor Login Page Loaded');
        
        // Set copyright year
        const yearSpan = document.getElementById('year');
        if (yearSpan) {
          yearSpan.textContent = new Date().getFullYear();
        }
        
        // Initialize Firebase
        let auth;
        try {
          const app = initializeApp(firebaseConfig);
          auth = getAuth(app);
          console.log('✅ Firebase initialized');
        } catch (error) {
          console.error('❌ Firebase init error:', error);
          showLoginError('System initialization failed. Please refresh.');
          return;
        }
        
        // Handle login form
        const loginForm = document.getElementById('vendor-login-form');
        const loginError = document.getElementById('login-error');
        
        if (loginForm) {
          loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Reset error
            if (loginError) {
              loginError.classList.add('d-none');
              loginError.textContent = '';
            }
            
            // Validate
            if (!email || !password) {
              showLoginError('Please enter email and password');
              return;
            }
            
            // Show loading
            const submitBtn = loginForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Signing in...';
            
            try {
              // Sign in
              await signInWithEmailAndPassword(auth, email, password);
              
              // Redirect to vendor dashboard
              window.location.href = 'vendor-dashboard.html';
              
            } catch (error) {
              console.error('Login error:', error);
              showLoginError(getErrorMessage(error.code));
            } finally {
              // Reset button
              submitBtn.disabled = false;
              submitBtn.innerHTML = originalText;
            }
          });
        }
        
        function showLoginError(message) {
          if (loginError) {
            loginError.textContent = message;
            loginError.classList.remove('d-none');
          }
        }
        
        function getErrorMessage(errorCode) {
          switch(errorCode) {
            case 'auth/invalid-email':
              return 'Invalid email address.';
            case 'auth/user-disabled':
              return 'This account has been disabled.';
            case 'auth/user-not-found':
              return 'No vendor account found with this email.';
            case 'auth/wrong-password':
              return 'Incorrect password.';
            case 'auth/too-many-requests':
              return 'Too many attempts. Please try again later.';
            default:
              return 'Login failed. Please check your credentials.';
          }
        }
      });
    </script>
  </body>
</html>